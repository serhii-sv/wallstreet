$(document).ready((function(){var a,t,e,n=boards;$(document).on("focusout",".kanban-title-board",(function(){return $(this).attr("contenteditable","true"),$(this).addClass("line-ellipsis"),$.ajax({url:"/kanban/board/"+$(this).closest(".kanban-board").data("id")+"/update",method:"post",data:{title:$(this).text(),_token:$('meta[name="csrf-token"]').attr("content")},success:a=>{}}),!1}));var d,i=new jKanban({element:"#kanban-app",buttonContent:"+ Создать задачу",widthBoard:"300px",click:function(a){},dropEl:function(a,t,e,n){let d=$(a).data("eid"),s=i.getParentBoardID(d),r={};$(a).closest(".kanban-board").find(".kanban-item").each(((a,t)=>{r[$(t).data("eid")]=a+1})),$.ajax({url:"/kanban/board/"+s+"/task/change-board",method:"post",data:{task_id:d,tasks:r,_token:$('meta[name="csrf-token"]').attr("content")},success:a=>{}})},dragendBoard:function(a){let t={};$(".kanban-board").each(((a,e)=>{t[$(e).data("id")]=$(e).data("order")})),$.ajax({url:"/kanban/board/sort",method:"post",data:{boards:t,_token:$('meta[name="csrf-token"]').attr("content")},success:a=>{}})},buttonClick:function(a,t){var e=document.createElement("form");e.setAttribute("class","itemform"),e.innerHTML='<div class="input-field"><textarea class="materialize-textarea add-new-item" rows="2" autofocus required></textarea></div><div class="input-field display-flex"><button type="submit" class="btn-floating btn-small mr-2"><i class="material-icons">add</i></button><button type="button" id="CancelBtn" class="btn-floating btn-small"><i class="material-icons">clear</i></button></div>',i.addForm(t,e),e.addEventListener("submit",(function(a){a.preventDefault();var d=a.target[0].value;let s=n.filter((a=>{if(a.id===t)return a}));return $.ajax({url:"/kanban/board/"+s[0].id+"/task/store",method:"post",data:{title:d,order:$(".kanban-item").length+1,_token:$('meta[name="csrf-token"]').attr("content")},success:a=>{a.success?(i.addElement(t,{title:a.task.title,id:a.task.id,dueDate:a.task.dueDate,border:a.task.border}),r(a.task.id),e.parentNode.removeChild(e)):M.toast({html:a.message,classes:"red"})}}),!1})),$(document).on("click","#CancelBtn",(function(){$(this).closest(e).remove()}))},addItemButton:!0,boards:n});for(a in n)for(t in n[a].item){var s=n[a].item[t];r($(s).attr("id"))}function r(s){if(d=i.findElement(s),board_item_users=board_item_dueDate=board_item_comment=board_item_attachment=board_item_image=board_item_badge=" ",void 0!==$(d).attr("data-users"))for(e in n[a].item[t].users)board_item_users+='<img class="circle" src=" '+n[a].item[t].users[e]+'" alt="Avatar" height="24" width="24">';void 0!==$(d).attr("data-dueDate")&&(board_item_dueDate='<div class="kanban-due-date center mb-5 lighten-5 '+$(d).attr("data-border")+'"><span class="'+$(d).attr("data-border")+'-text center"> '+$(d).attr("data-dueDate")+"</span></div>"),void 0!==$(d).attr("data-comment")&&(board_item_comment='<div class="kanban-comment display-flex"><i class="material-icons font-size-small">chat_bubble_outline </i><span class="font-size-small">'+$(d).attr("data-comment")+"</span></div>"),void 0!==$(d).attr("data-attachment")&&(board_item_attachment='<div class="kanban-attachment display-flex"><i class="font-size-small material-icons">attach_file</i><span class="font-size-small">'+$(d).attr("data-attachment")+"</span></div>"),void 0!==$(d).attr("data-image")&&(board_item_image='<div class="kanban-image mb-1"><img class="responsive-img border-radius-4" src=" '+n[a].item[t].image+'" alt="kanban-image">'),void 0!==$(d).attr("data-badgeContent")&&(board_item_badge='<div class="kanban-badge circle lighten-4 '+n[a].item[t].badgeColor+'"><span class="'+n[a].item[t].badgeColor+'-text">'+n[a].item[t].badgeContent+"</span>"),void 0!==($(d).attr("data-dueDate")||$(d).attr("data-comment")||$(d).attr("data-users")||$(d).attr("data-attachment"))&&($(d).html('<div class="display-flex justify-content-between align-items-start">\n    <div>\n'+$(d).text()+'    </div>\n    <div>\n        <i class="material-icons remove-kanban_item" style="cursor: pointer">clear</i>\n    </div>\n</div>'),$(d).append('<div class="kanban-footer mt-3">'+board_item_dueDate+'<div class="kanban-footer-left left display-flex pt-1">'+board_item_comment+board_item_attachment+'</div><div class="kanban-footer-right right"><div class="kanban-users">'+board_item_badge+board_item_users+"</div></div></div>")),void 0!==$(d).attr("data-image")&&$(d).prepend(board_item_image)}n.map((function(a){$(".kanban-board[data-id='"+a.id+"']").find(".kanban-board-header").addClass(a.headerBg)})),$(document).on("click",".remove-kanban_item",(function(){var a=$(this).closest(".kanban-board").attr("data-id"),t=$(this).closest(".kanban-item").attr("data-eid");$.ajax({url:"/kanban/board/"+a+"/destroy/"+t,success:a=>{a.success?i.removeElement(t):M.toast({html:a.message,classes:"red"})}})}));var o=document.getElementById("add-kanban");o.addEventListener("click",(function(){let a=$(".kanban-board").length+1;$.ajax({url:"/kanban/board/store",method:"post",data:{title:"Доска №"+a,order:a,_token:$('meta[name="csrf-token"]').attr("content")},success:a=>{if(a.success){i.addBoards([{id:a.board.id,title:a.board.title}]);var t=i.findBoard(a.board.id);if(t){document.createElement("div").setAttribute("class","dropdown"),kanbanNewBoardData='<div class="dropdown"><a class="dropdown-trigger" href="#" data-target="kan_'+a.board.id+'" > <i class="material-icons white-text">more_vert</i></a><ul id="kan_'+a.board.id+'" class="dropdown-content"><li><a href="#!"><i class="material-icons">link</i><span class="menu-item">Скопировать ссылку</span></a></li><li class="kanban-delete"><a href="#!"><i class="material-icons">delete</i><span class="menu-item">Удалить</span></a></li></ul></div>';var e=$(t).find("header");$(e).append(kanbanNewBoardData),$(".dropdown-trigger").dropdown({constrainWidth:!1})}0}else M.toast({html:a.message,classes:"red"})}})})),$(document).on("click",".kanban-delete",(function(a){var t=$(this).closest(".kanban-board").attr("data-id");addEventListener("click",(function(){$.ajax({url:"/kanban/board/"+t+"/destroy",success:a=>{a.success?i.removeBoard(t):M.toast({html:a.message,classes:"red"})}})}))}));var l=document.createElement("div");if(l.setAttribute("class","dropdown"),l.innerHTML='<a class="dropdown-trigger" href="#" data-target="" > <i class="material-icons white-text">more_vert</i></a><ul id="" class="dropdown-content"><li><a href="#!"><i class="material-icons">link</i><span class="menu-item">Copy Link</span></a></li><li class="kanban-delete"><a href="#!"><i class="material-icons">delete</i><span class="menu-item">Delete</span></a></li></ul>',$(".kanban-board-header div").hasClass("dropdown")||$(".kanban-board-header").append(l),$(".kanban-sidebar .delete-kanban-item, .kanban-sidebar .close-icon, .kanban-sidebar .update-kanban-item, .kanban-overlay").on("click",(function(){$(".kanban-overlay").removeClass("show"),$(".kanban-sidebar").removeClass("show")})),$(document).on("click",".delete-kanban-item",(function(){$delete_item=undefined,addEventListener("click",(function(){i.removeElement($delete_item)}))})),$(document).on("mouseenter",".kanban-title-board",(function(){$(this).attr("contenteditable","true"),$(this).addClass("line-ellipsis")})),$(".kanban-sidebar").length>0)new PerfectScrollbar(".kanban-sidebar",{theme:"dark",wheelPropagation:!1});$(".kanban-board").each(((a,t)=>{$(".kanban-board[data-id='"+$(t).data("id")+"']").find(".kanban-board-header .dropdown-trigger").attr("data-target",a+1),$(".kanban-board[data-id='"+$(t).data("id")+"']").find("ul").attr("id",a+1)})),$(".dropdown-trigger").dropdown({constrainWidth:!1})})),$(window).on("resize",(function(){$(".kanban-sidebar").removeClass("show"),$(".kanban-overlay").removeClass("show")}));
